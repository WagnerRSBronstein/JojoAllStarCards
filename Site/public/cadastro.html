<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro</title>
    <link rel="stylesheet" href="css/cadastro.css">
    <link rel="icon" href="assets/logo.png">
</head>

<body>
    <div class="container-pai">
        <header>
            <div class="container">
                <a href="index.html"><img src="assets/logo.png" alt="logo_JojoAllStarCards" width="50px" /></a>
                <ul class="navbar">
                    <li><a href="index.html">Voltar para a página inicial</a></li>

                </ul>
            </div>
        </header>
        <div class="alerta_erro">
            <div class="card_erro" id="cardErro">
                <span id="mensagem_erro"></span>
            </div>
        </div>
        <div class="main">
            <div class="container">
                <img src="assets/logo.png" alt="" class="fundo">
                <br>
                <br>
                <h3>CADASTRO</h3>
                <br>
                <div class="container-campos">
                    <div class="campos">
                        <div class="ladoEsquerdo">
                            <div class="caixaInput">
                                <p class="cabecalho">Nome:</p>
                                <input type="text" placeholder="Ex: Jojo" id="input_nome" oninput="cadastrarNome()"
                                    value="Jorge" />
                                <p id="erro_nome"></p>
                            </div>
                            <div class="caixaInput">
                                <p class="cabecalho">E-mail:</p>
                                <input type="text" placeholder="Ex: .Joestar@sptech.school" id="input_email"
                                    oninput="cadastrarEmail()" value="JolyneJoestar1@gmail.com" />
                                <p id="erro_email"></p>
                            </div>
                            <div class="caixaInput">
                                <p class="cabecalho">Data de nascimento:</p>
                                <input type="text" placeholder="Ex: 21/01/2007" id="input_nascimento"
                                    oninput="cadastrarNascimento()" value="20010205" />
                                <p id="erro_nascimento"></p>
                            </div>
                            <div class="caixaInput">
                                <p class="cabecalho">Confirmar senha:</p>
                                <input type="password" placeholder="Ex: Jojo#2025" id="input_confirmarsenha"
                                    oninput="cadastrarConfirmarSenha()" value="Jojo#2025" />
                                <p id="erro_confirmarsenha"></p>
                            </div>
                        </div>
                        <div class="ladoDireito">
                            <div class="caixaInput">
                                <p class="cabecalho">Sobrenome:</p>
                                <input type="text" placeholder="Ex: Joestar" id="input_sobrenome"
                                    oninput="cadastrarSobrenome()" value="Joestar" />
                                <p id="erro_sobrenome"></p>
                            </div>


                            <div class="caixaInput">
                                <p class="cabecalho">Telefone:</p>
                                <input type="text" placeholder="Ex: 1191234123" id="input_telefone"
                                    oninput="cadastrarTelefone()" value="11998682919" />
                                <p id="erro_telefone"></p>
                            </div>

                            <div class="caixaInput">
                                <p class="cabecalho">Senha:</p>
                                <input type="password" placeholder="Ex: Jojo#2025" id="input_senha"
                                    oninput="cadastrarSenha()" value="Jojo#2025" />
                                <p id="erro_senha1"></p>
                                <p id="erro_senha2"></p>
                                <p id="erro_senha3"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="div_button">
                    <br>
                    <button id="button_cadastrar" onclick="cadastrar()">Cadastrar</button>
                    <p id="erro_confirmarcadastro"></p>
                    <br>
                    <a href="login.html">Login </a>
                </div>
            </div>
        </div>
    </div>
    </div>
</body>

</html>

<!-- // --------------------------------------------------- -->
<script>
    var senha = ``
    var confirmacaoCadastro1 = 'a'
    var confirmacaoCadastro2 = 'b'
    var confirmacaoCadastro3 = 'c'
    var confirmacaoCadastro4 = 'd'
    var confirmacaoCadastro5 = 'e'
    var confirmacaoCadastro6 = 'f'
    var confirmacaoCadastro7 = 'g'
    function cadastrarNome() {
        var nome = input_nome.value;



        // ver se o nome está com alguma caractere especial
        if (
            nome.includes("!") ||
            nome.includes("@") ||
            nome.includes("#") ||
            nome.includes("$") ||
            nome.includes("%") ||
            nome.includes("&") ||
            nome.includes("*") ||
            nome.includes("(") ||
            nome.includes(")")
        ) {
            erro_nome.innerHTML = `Você precisa inserir um nome válido.`;
            confirmacaoCadastro1 = 'a'
        } else {
            erro_nome.innerHTML = ``;
            confirmacaoCadastro1 = 'A'
        }
    }
    function cadastrarSobrenome() {
        var sobrenome = input_sobrenome.value;
        if (
            sobrenome.includes("!") ||
            sobrenome.includes("@") ||
            sobrenome.includes("#") ||
            sobrenome.includes("$") ||
            sobrenome.includes("%") ||
            sobrenome.includes("&") ||
            sobrenome.includes("*") ||
            sobrenome.includes("(") ||
            sobrenome.includes(")")
        ) {
            erro_sobrenome.innerHTML = `Você precisa inserir um sobrenome válido.`;
            confirmacaoCadastro2 = 'b'
        } else {
            erro_sobrenome.innerHTML = ``;
            confirmacaoCadastro2 = 'B'
        }
    }
    function cadastrarEmail() {
        var email = input_email.value;
        if (
            email.includes("@") &&
            ((email.includes("!") ||
                email.includes("#") ||
                email.includes("$") ||
                email.includes("%") ||
                email.includes("&") ||
                email.includes("*") ||
                email.includes("(") ||
                email.includes(")") == false))
        ) {
            erro_email.innerHTML = ``;
            confirmacaoCadastro3 = 'C'
        } else {
            erro_email.innerHTML = `Você precisa inserir um email válido.`;
            confirmacaoCadastro3 = 'c'
        }
    }

    function cadastrarTelefone() {
        var telefone = input_telefone.value;
        telefone = telefone
            .trim()
            .replaceAll(" ", "")
            .replaceAll("-", "")
            .replaceAll("(", "")
            .replaceAll(")", "");
        if (isNaN(Number(telefone)) == true) {
            erro_telefone.innerHTML = `Você precisa inserir um telefone válido.`;
            confirmacaoCadastro4 = 'd'
        } else {
            erro_telefone.innerHTML = ``;
            confirmacaoCadastro4 = 'D'
        }
    }
    function cadastrarNascimento() {
        var nascimento = input_nascimento.value.replaceAll("/", "");

        var valido = false;

        while (valido == false) {
            if (nascimento == '' || nascimento.length < 8 || nascimento.length > 8) {
                erro_nascimento.innerHTML = `Você precisa inserir uma data válida.`;
                confirmacaoCadastro5 = 'e';
                valido = true;
            } else {
                erro_nascimento.innerHTML = ``;
                confirmacaoCadastro5 = 'E';
                valido = true;
            }
        }
    }
    function cadastrarSenha() {
        senha = input_senha.value;
        var tamanhoSenha = senha.length
        var senhaMaisucula = senha.toUpperCase();
        var senhaMinuscula = senha.toLowerCase();
        if (
            tamanhoSenha >= 8 &&
            senha != senhaMaisucula &&
            senha != senhaMinuscula
        ) {
            erro_senha1.innerHTML = ``;
            erro_senha2.innerHTML = ``;
            erro_senha3.innerHTML = ``;
            confirmacaoCadastro6 = 'F'
        } else {
            confirmacaoCadastro6 = 'f'
            if (senha.length < 8) {
                erro_senha1.innerHTML = `A senha precisa ter no mínimo 8 caracteres.`;
            } else {
                erro_senha1.innerHTML = ``;
            }
            if (senha == senhaMaisucula) {
                erro_senha2.innerHTML = `A senha precisa ter no mínimo 1 letra em caixa baixa.`;
            } else {
                erro_senha2.innerHTML = ``;
            }
            if (senha == senhaMinuscula) {
                erro_senha3.innerHTML = `A senha precisa ter no mínimo 1 letra em caixa alta.`;
            } else {
                erro_senha3.innerHTML = ``;
            }
        }
    }
    function cadastrarConfirmarSenha() {
        var confirmarsenha = input_confirmarsenha.value;
        if (senha == confirmarsenha) {
            erro_confirmarsenha.innerHTML = ``;
            confirmacaoCadastro7 = 'G';
        } else {
            erro_confirmarsenha.innerHTML = `A senha não está correta`;
            confirmacaoCadastro7 = 'g';
        }

    }

    function cadastrar() {
        var nome = input_nome.value;
        var sobrenome = input_sobrenome.value;
        var telefone = input_telefone.value;
        var senha = input_senha.value;
        var nascimento = input_nascimento.value;
        var email = input_email.value;

        if (
            confirmacaoCadastro1 == 'A' &&
            confirmacaoCadastro2 == 'B' &&
            confirmacaoCadastro3 == 'C' &&
            confirmacaoCadastro4 == 'D' &&
            confirmacaoCadastro5 == 'E' &&
            confirmacaoCadastro6 == 'F' &&
            confirmacaoCadastro7 == 'G'
        ) { erro_confirmarcadastro.innerHTML = `<b style="color:green">Cadastro realizado com sucesso!` } else { erro_confirmarcadastro.innerHTML = `<b style="color:red">Falha ao cadastrar.</b>` }

        fetch('/usuarios/cadastrar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                nomeServer: nome,
                sobrenomeServer: sobrenome,
                telefoneServer: telefone,
                senhaServer: senha,
                nascimentoServer: nascimento,
                emailServer: email

            }),

        })
            .then(function (resposta) {
                if (resposta.ok) {
                    alert('Cadastro realizado com sucesso! Redirecionando para a tela de login...')

                    setTimeout(() => {
                        window.location = 'login.html'
                    }, '2000')
                } else {
                    alert('Houve um erro ao tentar realizar o cadastro!')
                    throw 'Houve um erro ao tentar realizar o cadastro!'
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`)
            })

        return false

    }

</script>