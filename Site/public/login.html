<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login</title>
  <link rel="stylesheet" href="css/login.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="icon" href="assets/logo.png" />
</head>

<body>
  <div class="container-pai">
    <header>
      <div class="container">
        <a href="index.html"><img src="assets/logo.png" alt="logo_beetech" width="50px" /></a>
        <ul class="navbar">
          <li class="voltar"><a href="index.html" style="margin-top: -2;">Voltar</a><img src="assets/voltar.png" width="50px"></li>

        </ul>
      </div>
    </header>
    <div class="main">
      <div class="container">
        <img src="assets/logo.png" alt="" id="img_logo" />
        <h3>LOGIN</h3>
        <div class="campos">
          <div class="dados">
            <div class="caixa_input">
              <h3>Usuário:</h3>
              <input type="text" placeholder="Ex: JonathanJoestar@sptech.school" id="input_email" />
            </div>

            <div class="caixaInput">
              <h3>Senha:</h3>
              <input type="password" placeholder="Ex: Jojo#2025" id="input_senha" />
            </div>
          </div>
        </div>
        <div class="div_button">
          <button onclick="logar()">Logar</button>
          <li><a href="cadastro.html">Cadastrar-se</a></li>
          <p id="div_mensagem"></p>
          <a href="tela-de-cadastro.html"><label for="">Cadastro</label></a>
        </div>
      </div>
    </div>
  </div>
</body>

</html>
<script>
  // vetor de um usuario já registrado
  var usuarioRegistrado = ["Jojo.Joestar@sptech.school", "Jojo#2025"];
  //[0]-usuario/email
  //[1] senha
  var contTentativas = 3;
  var logado = false;

  function logar() {
    var email = input_email.value;
    var senha = input_senha.value;

    while (contTentativas > 0 && logado == false) {
      if (usuarioRegistrado.includes(email)) {
        if (usuarioRegistrado[1] == senha) {
          div_mensagem.innerHTML = "<b style='color:green'>Login realizado com sucesso!</b>";
          logado = true;
          location.href = 'selecao.html';
        } else {
          contTentativas--;
          if (contTentativas > 0) {
            div_mensagem.innerHTML = `<b style="color:red">Senha inválida, tentativa(s) restante(s): ${contTentativas}</b>`;
          } else {
            div_mensagem.innerHTML = "<b style='color:red'>Login bloqueado!</b>";
          }
        }
      } else {
        div_mensagem.innerHTML = "<b style='color:red'>Usuário inválido.</b>";
        contTentativas = 0;
      }
    }
    fetch('/usuarios/autenticar',{
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        emailServer: email,
        senhaServer: senha
      })
    })
      .then(function(resposta){
        if(resposta.ok) {
          // document.getElementById('textError').textContent = ''
          resposta.json().then(json => {
            sessionStorage.NOME_USUARIO = json.nome

            setTimeout(function (){
              window.location = 'selecao.html'
            }, 1000)
          })

        } else {
          div_mensagem.innerHTML = "<b style='color:red'>Usuário inválido.</b>";
        }
      }).catch(function (erro){
        console.log(erro)
      })
      return false
  }
</script>